## Preface

This function is used to call each other's methods across platforms to achieve cross platform compatibility.

## Function

- [x] Acquire device terminal system
- [x] Ajax encapsulation
- [x] Cross platform

## Script description and presentation
  
  First, Introduce "./js/common.js" public script.
  ```html
    <script src="./js/common.js"></script>
  ```

  Second, initialize data to obtain current equipment and current exchange rate.
  ```JavaScript
    // common.js
    initialize: function() {
        window.terminal = this.getTerminal()
        this.ajax({
            url:"https://api.gmc-core.com/data/v3/api/gmc",
            type:"get",
            data: {
                to: "CMY"
            },
            dataType: "json",
            timeout: 10000,
            contentType: "application/json",
            success: function(data) {
                let res = JSON.parse(data)
                if (res.status == 1 && res.data) {
                    document.getElementById("rmb").innerHTML = res.data
                    document.getElementById("pay_rmb").innerHTML = res.data
                }
            },
            error: function(e) {
                console.log(e)
            }
        })
    }
  ```
  ```JavaScript
    // index.js
    app.initialize()
  ```

  Third, get the order number generated by the server.
  ```JavaScript
    // index.js
    let Num = "";
    for(var i=0;i<6;i++) {
        Num += Math.floor(Math.random()*10);
    }
    let orderid = new Date().getTime() + Num  // This order number is generated by the server and returned to the client
  ```

  Fourth, H5 cross platform(IOS/Andriod) bridge.
  ```JavaScript
    // index.js
    let params = {
        order_id: "202005180029", // Generated and returned by the server
        gmc_num: gmcNUm,
        address: "gmc59265e7673c997089e74ffedfgrw00e954787jkh"
    }
    if (terminal == "ios") {
        app.setupWebViewJavascriptBridge(function(bridge) {
            payBtn.onclick = function (e) {
                bridge.callHandler("payAction", params, callback(response) {
                    payForCallbackIos(response)
                })
            }
        })
    } else {
        payBtn.onclick = function (e) {
            let paramStr = JSON.stringify(params)
            android.payAction(paramStr, callback(response) {
                payForCallback(response)
            })
        }
    }
  ```

  Finally, after the cross platform call, get the return value from the callback function and handle the callback event.  

## API
  1. Order Status Query
     ```Java
     /**
     * orderId: Order number 
     * address: Merchant authentication address
     */
     Get Request
     https://api.gmc-core.com/data/v3/api/storePay/{orderId}?address=
     
     Response
     {
         "status": "1",
         "message": "SECCESS",
         "data": {
             "status": 1 // 1 Unpaid,  200 SUCCESS
         },
         "timestamp": "08/07/2020 08:20:59679"
     }
     ```
  2. Account Details Query
     ```Java
     /**
      * address: Merchant authentication address
      */
     Get Request
     https://api.gmc-core.com/data/v3/api/storePay/fundLog/{address}
     
     Response
     {
         "status": "1",
         "message": "SECCESS",
         "data": [
             {
                 "orderId": "6", // Order Number
                 "status": 8, // 1 Account not received, 8 Received account
                 "ptype": "GMC" // Coin type
             },
            ...
         ],
         "timestamp": "10/07/2020 06:14:27518"
     }
     ```
  3. Get GMC Price
     ```Java
     Get Request
     https://api.gmc-core.com/data/v3/api/gmc

     Response
         {
            "status": "1",
            "message": "SECCESS",
            "data": 1.388,
            "timestamp": "16/07/2020 08:44:01262"
        }
     ```

## Notice

  1.Ajax cross domain problem.

  2.Cross platform agreement.



## 前言

此方法用于跨平台之间的相互通讯和相互调用，以实现跨平台之间的兼容性。

## 功能函数

- [x] 获取移动终端信息
- [x] Ajax请求
- [x] 跨平台桥接

## 脚本使用演示
  第一步：引入功能函数文件
  ```html
    <script src="./js/common.js"></script>
  ```

  第二步：调用初始化方法，获取移动终端信息和获取当前汇率
  ```JavaScript
    // common.js
    initialize: function() {
        window.terminal = this.getTerminal()
        this.ajax({
            url:"https://api.gmc-core.com/data/v3/api/gmc",
            type:"get",
            data: {
                to: "CMY"
            },
            dataType: "json",
            timeout: 10000,
            contentType: "application/json",
            success: function(data) {
                let res = JSON.parse(data)
                if (res.status == 1 && res.data) {
                    document.getElementById("rmb").innerHTML = res.data
                    document.getElementById("pay_rmb").innerHTML = res.data
                }
            },
            error: function(e) {
                console.log(e)
            }
        })
    }
  ```
  ```JavaScript
    // index.js
    app.initialize()
  ```

  第三步：调用服务端生成订单号API。
  ```JavaScript
    // index.js
    let Num = "";
    for(var i=0;i<6;i++) {
        Num += Math.floor(Math.random()*10);
    }
    let orderid = new Date().getTime() + Num  // 此订单号由服务端生成返回给客户端
  ```

  第四步：H5跨平台（IOS/Andriod）。
  ```JavaScript
    // index.js
    let params = {
        order_id: "202005180029", // Generated and returned by the server
        gmc_num: gmcNUm,
        address: "gmc59265e7673c997089e74ffedfgrw00e954787jkh"
    }
    if (terminal == "ios") {
        app.setupWebViewJavascriptBridge(function(bridge) {
            payBtn.onclick = function (e) {
                bridge.callHandler("payAction", params, callback(response) {
                    payForCallbackIos(response)
                })
            }
        })
    } else {
        payBtn.onclick = function (e) {
            let paramStr = JSON.stringify(params)
            android.payAction(paramStr, callback(response) {
                payForCallback(response) // 由于安卓问题，此回调函数放在index.html文件上声明
            })
        }
    }
  ```

  最后，跨平台调用后，从回调函数中获取返回值并处理回调事件。

## API
  1. 订单状态查询
     ```Java
     /**
     * orderId: Order number 
     * address: Merchant authentication address
     */
     Get Request
     https://api.gmc-core.com/data/v3/api/storePay/{orderId}?address=
     
     Response
     {
         "status": "1",
         "message": "SECCESS",
         "data": {
             "status": 1 // 1 Unpaid,  200 SUCCESS
         },
         "timestamp": "08/07/2020 08:20:59679"
     }
     ```
  2. 交易详情
     ```Java
     /**
      * address: Merchant authentication address
      */
     Get Request
     https://api.gmc-core.com/data/v3/api/storePay/fundLog/{address}
     
     Response
     {
         "status": "1",
         "message": "SECCESS",
         "data": [
             {
                 "orderId": "6", // Order Number
                 "status": 8, // 1 Account not received, 8 Received account
                 "ptype": "GMC" // Coin type
             },
            ...
         ],
         "timestamp": "10/07/2020 06:14:27518"
     }
     ```
  3. 获取汇率
     ```Java
     Get Request
     https://api.gmc-core.com/data/v3/api/gmc

     Response
         {
            "status": "1",
            "message": "SECCESS",
            "data": 1.388,
            "timestamp": "16/07/2020 08:44:01262"
        }
     ```

## 注意事项
1. Ajax 跨域
2. 跨平台协议（h5端与终端约定协议，如：调用方法的方法名（payAction））
